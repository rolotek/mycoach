---
phase: 05-ui-polish-styling
plan: 09
type: execute
wave: 3
depends_on: ["05-07", "05-08"]
files_modified:
  - apps/web/src/app/(app)/chat/[id]/page.tsx
  - apps/web/src/app/(app)/chat/components/conversation-sidebar.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard Start Coaching Session card navigates to coaching thread"
    - "Complete coaching + task thread flow works end-to-end"
    - "Human verifies the sidebar layout matches the locked decision"
  artifacts:
    - path: "apps/web/src/app/(app)/dashboard/page.tsx"
      provides: "Dashboard links to coaching thread"
  key_links:
    - from: "apps/web/src/app/(app)/dashboard/page.tsx"
      to: "/chat"
      via: "Start Coaching Session card href"
      pattern: "href.*chat"
---

<objective>
Wire up remaining integration points (dashboard link, app build verification) and perform human verification of the complete coaching + task thread experience.

Purpose: Ensure the full flow works end-to-end: user opens coaching session, has a conversation, triggers agent dispatch, sees inline summary, navigates to task thread, resets coaching. The human checkpoint confirms the sidebar layout matches the locked decision.

Output: Verified, working conversation model with coaching + task threads.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-ui-polish-styling/05-CONTEXT.md
@.planning/phases/05-ui-polish-styling/05-06-SUMMARY.md
@.planning/phases/05-ui-polish-styling/05-07-SUMMARY.md
@.planning/phases/05-ui-polish-styling/05-08-SUMMARY.md
@apps/web/src/app/(app)/dashboard/page.tsx
@apps/web/src/app/(app)/chat/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integration fixes, build verification, and edge case handling</name>
  <files>apps/web/src/app/(app)/chat/[id]/page.tsx, apps/web/src/app/(app)/chat/components/conversation-sidebar.tsx</files>
  <action>
1. **Dashboard link:** The dashboard "Start Coaching Session" card already links to `/chat` which now does `getOrCreateCoaching`. Verify this works — no code change should be needed, but confirm the href is `/chat`.

2. **Chat detail edge cases for task threads:** In `chat/[id]/page.tsx`, when viewing a task thread:
   - The ModeToggle should be hidden (task threads don't need mode switching — they contain finished agent output).
   - The ChatInput should be hidden or disabled (task threads are read-only displays of agent results).
   - Use `conv?.type` to determine if this is a task thread. If `type === "task"`, hide ModeToggle and ChatInput, and show a "Back to coaching" link in the header that navigates to `/chat`.

3. **Sidebar: handle empty task threads state:** If there are no task threads yet, the "Recent Tasks" section should show a subtle "No tasks yet" message in `text-muted-foreground text-sm` instead of an empty space.

4. **Build verification:** Run `cd apps/web && npm run build` to ensure no build errors. Fix any issues.

5. **Type verification:** Run `cd apps/server && npx tsc --noEmit && cd ../web && npx tsc --noEmit`.
  </action>
  <verify>
`cd apps/web && npm run build` succeeds.
`cd apps/server && npx tsc --noEmit` succeeds.
`cd apps/web && npx tsc --noEmit` succeeds.
  </verify>
  <done>
Build passes. Task threads are read-only. Dashboard links to coaching thread correctly. Edge cases handled.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of complete coaching + task thread experience</name>
  <files>apps/web/src/app/(app)/chat/[id]/page.tsx</files>
  <action>
Present the complete hybrid coaching + task thread conversation model for human verification:
- Single pinned coaching thread (always accessible via Chat nav)
- Task threads created on agent dispatch completion
- Inline summary cards in coaching thread with "View result" links
- Sidebar layout: Coaching (pinned) with reset button, Recent Tasks below
- Reset button clears coaching messages, preserves memory/facts
- Task threads are read-only and deletable

Verification steps for the human:
1. Start dev servers: `cd apps/server && npm run dev` and `cd apps/web && npm run dev`
2. Navigate to http://localhost:3000/dashboard
3. Click "Start Coaching Session" — should open the coaching thread
4. Verify sidebar layout matches the locked decision:
   Coaching (pinned) with reset icon at top, separator, then Recent Tasks section below
5. Send a message to the coach — verify normal chat works
6. Trigger an agent dispatch (ask the coach to do a task that routes to an agent)
7. Approve the dispatch — verify an inline summary card appears (not full result)
8. Verify "View result" link appears on the summary card
9. Click "View result" — should navigate to task thread with full result + feedback buttons
10. Verify task thread appears in sidebar under "Recent Tasks"
11. Navigate back to coaching thread — verify coaching messages are intact
12. Click the reset button — confirm dialog should appear
13. Confirm reset — coaching messages should clear, but navigating to /memory shows facts still present
14. Verify the task thread is still accessible in the sidebar after reset
15. Try deleting a task thread from the sidebar
  </action>
  <verify>Human types "approved" or describes issues.</verify>
  <done>Human approves the complete conversation model experience.</done>
</task>

</tasks>

<verification>
- Full build passes (both server and web)
- Complete flow: coaching session -> agent dispatch -> inline summary -> task thread -> reset
- Sidebar layout matches the locked decision from CONTEXT.md
- Task threads are read-only
- Reset preserves userFacts and memory
- Human approval of the complete experience
</verification>

<success_criteria>
Human approves the complete coaching + task thread conversation model. Sidebar layout matches the locked decision. All flows work end-to-end. Build passes.
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-polish-styling/05-09-SUMMARY.md`
</output>

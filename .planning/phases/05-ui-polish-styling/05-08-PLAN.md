---
phase: 05-ui-polish-styling
plan: 08
type: execute
wave: 3
depends_on: ["05-07"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Full build passes without errors"
    - "User visually confirms the coaching + task thread flow works end-to-end"
  artifacts: []
  key_links: []
---

<objective>
Verify the hybrid conversation model works end-to-end: build check, then human visual verification of the coaching + task thread flow.

Purpose: The conversation model changes touch schema, backend logic, and frontend in interconnected ways. A build check ensures nothing is broken, and human verification confirms the UX matches the locked decisions.

Output: Verified, working hybrid conversation model.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-ui-polish-styling/05-06-SUMMARY.md
@.planning/phases/05-ui-polish-styling/05-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Full build and type check verification</name>
  <files></files>
  <action>
1. Run `npx tsc --noEmit` from `apps/server` -- must pass with zero errors.
2. Run `npx tsc --noEmit` from `apps/web` -- must pass with zero errors.
3. Run `npm run build` from the monorepo root -- must complete successfully.
4. If any errors are found, fix them before proceeding to the checkpoint.

Common things to check:
- tRPC type inference: apps/web should see the new `type`, `parentId` fields on conversation.list and the new `reset`, `getOrCreateCoaching` procedures
- Import paths: new components (AgentDispatchSummaryCard) must be properly exported and imported
- Schema self-reference: conversations.parentId FK must be valid with drizzle-orm
  </action>
  <verify>
`npx tsc --noEmit` exits 0 in both apps/server and apps/web.
`npm run build` exits 0 at monorepo root.
  </verify>
  <done>Full project builds and type-checks without errors.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of coaching + task thread UX</name>
  <action>
Present the hybrid conversation model for user verification. The following was built across plans 06 and 07:

- Single pinned coaching thread at top of conversation sidebar with reset button
- Task threads listed under "Recent Tasks" by recency
- /chat redirects to the coaching thread
- Agent dispatch approval creates an inline summary card in coaching thread with "View result" link
- Full agent output lives in its own task thread
- Reset clears coaching messages but preserves memory/userFacts

Verification steps:

1. Start the dev server: `npm run dev` from monorepo root
2. Navigate to http://localhost:3000/chat
   - Should redirect to the coaching thread
   - Sidebar should show "Coaching" pinned at top with a reset icon button
3. Send a message in the coaching thread
   - Verify the coach responds normally
   - Verify the sidebar still shows "Coaching" at top
4. (If agents are set up) Ask for something that triggers an agent dispatch:
   - Approve the dispatch
   - Verify a compact summary card appears inline (agent name, task, "View result")
   - Verify a new task thread appears in the sidebar under "Recent Tasks"
   - Click "View result" -- should navigate to the task thread with full output
5. Click the reset button on the coaching thread:
   - Should prompt for confirmation
   - After reset, coaching messages should be cleared
   - Navigate to /memory -- user facts should still be there
6. Check task thread sidebar items:
   - Can be deleted independently
   - Show title and date
7. Verify responsive behavior:
   - On mobile (narrow viewport), sidebar should be in a Sheet
  </action>
  <verify>User types "approved" or describes issues.</verify>
  <done>User confirms the coaching + task thread UX matches locked decisions.</done>
</task>

</tasks>

<verification>
1. Full build passes
2. Human verification confirms all three locked decisions are correctly implemented
</verification>

<success_criteria>
- Build and type-check pass without errors
- Human approves the coaching + task thread UX
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-polish-styling/05-08-SUMMARY.md`
</output>

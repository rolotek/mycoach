---
phase: 05-ui-polish-styling
plan: 08
type: execute
wave: 2
depends_on: ["05-06"]
files_modified:
  - apps/web/src/app/(app)/chat/components/message-list.tsx
  - apps/web/src/app/(app)/chat/components/agent-result.tsx
autonomous: true

must_haves:
  truths:
    - "Agent dispatch results in coaching thread show as compact inline summary card, not full result"
    - "Inline summary card shows agent name, task description, and a View result link"
    - "View result link navigates to the task thread at /chat/{taskThreadId}"
    - "Full agent output with feedback buttons only appears when viewing the task thread"
  artifacts:
    - path: "apps/web/src/app/(app)/chat/components/agent-result.tsx"
      provides: "AgentSummaryCard and AgentResultCard components"
      contains: "AgentSummaryCard"
    - path: "apps/web/src/app/(app)/chat/components/message-list.tsx"
      provides: "Renders AgentSummaryCard for dispatches in coaching thread"
      contains: "AgentSummaryCard"
  key_links:
    - from: "apps/web/src/app/(app)/chat/components/message-list.tsx"
      to: "apps/web/src/app/(app)/chat/components/agent-result.tsx"
      via: "renders AgentSummaryCard for output-available dispatches"
      pattern: "AgentSummaryCard"
    - from: "apps/web/src/app/(app)/chat/components/agent-result.tsx"
      to: "/chat/{taskThreadId}"
      via: "View result link navigation"
      pattern: "taskThreadId"
---

<objective>
Replace the full inline agent result display in the coaching chat with a compact summary card that links to the task thread, keeping the coaching conversation clean and conversational.

Purpose: Per user decision, the coaching thread should stay clean. Agent dispatch results show as compact summaries with "View result" links. The full output lives in its own task thread. This prevents long agent outputs from overwhelming the coaching conversation.

Output: Compact AgentSummaryCard in coaching thread, full AgentResultCard only in task thread view.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-ui-polish-styling/05-CONTEXT.md
@.planning/phases/05-ui-polish-styling/05-06-SUMMARY.md
@apps/web/src/app/(app)/chat/components/message-list.tsx
@apps/web/src/app/(app)/chat/components/agent-result.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AgentSummaryCard component for inline coaching thread display</name>
  <files>apps/web/src/app/(app)/chat/components/agent-result.tsx</files>
  <action>
Add a new `AgentSummaryCard` component to agent-result.tsx (keep existing `AgentResultCard`, `AgentDeniedCard`, and `FeedbackButtons` as-is):

```tsx
import Link from "next/link";
import { ExternalLink } from "lucide-react";

export function AgentSummaryCard({
  agentName,
  task,
  taskThreadId,
}: {
  agentName: string;
  task: string;
  taskThreadId?: string;
}) {
  return (
    <div className="flex items-center gap-3 rounded-lg border border-border bg-card px-4 py-3">
      <div className="flex-1 min-w-0">
        <div className="flex items-center gap-2">
          <Badge variant="secondary">{agentName}</Badge>
          <span className="text-xs text-muted-foreground">completed</span>
        </div>
        <p className="mt-1 truncate text-sm text-muted-foreground">{task}</p>
      </div>
      {taskThreadId && (
        <Link
          href={`/chat/${taskThreadId}`}
          className="flex shrink-0 items-center gap-1 text-sm font-medium text-primary hover:underline"
        >
          View result
          <ExternalLink className="h-3 w-3" />
        </Link>
      )}
    </div>
  );
}
```

The summary card is compact — one line for agent name + status, one line for task description (truncated), and a "View result" link on the right. No full result text, no feedback buttons. Those only appear in the task thread via the existing `AgentResultCard`.

The `taskThreadId` comes from the tool output (added by the agent executor in Plan 05-06). If `taskThreadId` is not present (e.g., for older executions before the migration), fall back to showing the full `AgentResultCard` as before.

Import `Badge` from `@/components/ui/badge` (already imported in the file) and `Link` from `next/link` and `ExternalLink` from `lucide-react`.
  </action>
  <verify>
`cd apps/web && npx tsc --noEmit` passes.
  </verify>
  <done>
AgentSummaryCard component exists with agent name badge, truncated task, and "View result" link to task thread.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update message-list to render AgentSummaryCard for dispatches with taskThreadId</name>
  <files>apps/web/src/app/(app)/chat/components/message-list.tsx</files>
  <action>
Modify the `message-list.tsx` component's dispatch rendering logic. In the section that handles `part.state === "output-available" && part.output`:

1. Import `AgentSummaryCard` from `./agent-result`.

2. Update the `MessageListMessage` type's `output` to include `taskThreadId?: string`.

3. When rendering a dispatch part with `state === "output-available"`:
   - If `output.taskThreadId` exists, render `<AgentSummaryCard>` instead of `<AgentResultCard>`. Pass `agentName`, `task` (from `part.input?.task`), and `taskThreadId`.
   - If `output.taskThreadId` does NOT exist (legacy executions), continue rendering the full `<AgentResultCard>` as before (backward compatible).

The change is minimal — replace one component with another based on whether taskThreadId is present:

```tsx
if (part.state === "output-available" && part.output) {
  const out = part.output;
  if (out.taskThreadId) {
    // New: compact summary for coaching thread
    return (
      <div key={`${m.id}-${i}`} className="max-w-[85%]">
        <AgentSummaryCard
          agentName={out.agentName ?? agentName}
          task={part.input?.task ?? "Agent task"}
          taskThreadId={out.taskThreadId}
        />
      </div>
    );
  }
  // Fallback: full result card for legacy executions
  const result = typeof out.result === "string" ? out.result : String(out.result ?? "");
  const name = out.agentName ?? agentName;
  return (
    <div key={`${m.id}-${i}`} className="max-w-[85%]">
      <AgentResultCard
        agentName={name}
        result={result}
        executionId={out.executionId}
        agentId={out.agentId}
      />
    </div>
  );
}
```

This keeps the coaching conversation clean — users see a summary card and click through to the full result in the task thread.
  </action>
  <verify>
`cd apps/web && npx tsc --noEmit` passes.
Manual test: In the coaching chat, trigger an agent dispatch. After approval and execution, the inline display should show a compact summary card with "View result" link instead of the full agent output.
  </verify>
  <done>
Agent dispatch results in the coaching thread display as compact summary cards with "View result" links to task threads. Legacy executions (without taskThreadId) still show full results for backward compatibility.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes in apps/web
- New dispatches show AgentSummaryCard (compact: agent name, task, "View result" link)
- Legacy dispatches (no taskThreadId) still show AgentResultCard with full output
- "View result" link navigates to /chat/{taskThreadId} where the full result is visible
- FeedbackButtons only appear in the task thread view, not in the inline summary
</verification>

<success_criteria>
Coaching conversation stays clean and conversational. Agent dispatch results appear as compact inline summaries with links to full results in task threads. Backward compatible with existing executions.
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-polish-styling/05-08-SUMMARY.md`
</output>

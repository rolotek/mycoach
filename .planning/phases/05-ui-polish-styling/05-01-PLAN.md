---
phase: 05-ui-polish-styling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/postcss.config.mjs
  - apps/web/components.json
  - apps/web/src/app/globals.css
  - apps/web/src/app/layout.tsx
  - apps/web/src/app/(app)/layout.tsx
  - apps/web/src/providers/index.tsx
  - apps/web/src/lib/utils.ts
  - apps/web/src/components/theme-provider.tsx
  - apps/web/src/components/theme-toggle.tsx
  - apps/web/src/components/app-sidebar.tsx
  - apps/web/src/components/page-header.tsx
  - apps/web/src/components/chat-markdown.tsx
  - apps/web/src/components/ui/*
  - apps/web/package.json
autonomous: true
must_haves:
  truths:
    - "shadcn/ui components are installed and importable from @/components/ui/*"
    - "Design tokens (colors, radii, spacing) are defined as CSS variables in globals.css"
    - "Dark mode toggles between light and dark themes without FOUC"
    - "All authenticated pages render inside a collapsible sidebar navigation shell"
    - "Sidebar shows navigation links to Dashboard, Chat, Agents, Memory, Documents, Settings"
    - "Inter font loads with zero layout shift via next/font"
    - "ChatMarkdown component renders full markdown (headers, code, lists, tables) via react-markdown"
  artifacts:
    - path: "apps/web/postcss.config.mjs"
      provides: "PostCSS config for Tailwind v4"
    - path: "apps/web/components.json"
      provides: "shadcn/ui configuration"
    - path: "apps/web/src/app/globals.css"
      provides: "Design tokens (OKLCH colors, radii) for light and dark themes"
      contains: "@theme inline"
    - path: "apps/web/src/lib/utils.ts"
      provides: "cn() utility (clsx + tailwind-merge)"
      exports: ["cn"]
    - path: "apps/web/src/components/theme-provider.tsx"
      provides: "next-themes ThemeProvider wrapper"
    - path: "apps/web/src/components/theme-toggle.tsx"
      provides: "Light/dark/system theme toggle button"
    - path: "apps/web/src/components/app-sidebar.tsx"
      provides: "Main navigation sidebar using shadcn/ui Sidebar"
    - path: "apps/web/src/components/page-header.tsx"
      provides: "Reusable page title + description + actions header"
    - path: "apps/web/src/components/chat-markdown.tsx"
      provides: "Shared markdown renderer using react-markdown + remark-gfm"
  key_links:
    - from: "apps/web/src/app/layout.tsx"
      to: "apps/web/src/components/theme-provider.tsx"
      via: "ThemeProvider wrapping Providers"
      pattern: "ThemeProvider"
    - from: "apps/web/src/app/(app)/layout.tsx"
      to: "apps/web/src/components/app-sidebar.tsx"
      via: "SidebarProvider + AppSidebar + SidebarInset"
      pattern: "SidebarProvider"
    - from: "apps/web/src/app/globals.css"
      to: "all components"
      via: "CSS variables consumed by Tailwind semantic classes"
      pattern: "--color-primary.*var\\(--primary\\)"
---

<objective>
Initialize shadcn/ui design system foundation: PostCSS config, design tokens, dark mode, font, app shell with sidebar navigation, and shared components (ChatMarkdown, PageHeader).

Purpose: Every subsequent plan depends on the design system, shared components, and app shell being in place. This plan establishes the single source of truth for all UI styling.

Output: Working app shell with sidebar navigation, dark mode toggle, design tokens, and all shadcn/ui primitives installed. All existing pages continue to function (they still render inside the new shell, just not yet restyled).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-ui-polish-styling/05-RESEARCH.md
@apps/web/package.json
@apps/web/src/app/globals.css
@apps/web/src/app/layout.tsx
@apps/web/src/app/(app)/layout.tsx
@apps/web/src/providers/index.tsx
@apps/web/src/components/auth-guard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies, init shadcn/ui, install all needed components</name>
  <files>
    apps/web/postcss.config.mjs
    apps/web/components.json
    apps/web/src/lib/utils.ts
    apps/web/src/app/globals.css
    apps/web/src/components/ui/*
    apps/web/package.json
  </files>
  <action>
    1. Create `apps/web/postcss.config.mjs`:
       ```js
       export default { plugins: { "@tailwindcss/postcss": {} } }
       ```

    2. From `apps/web/`, run `npx shadcn@latest init` with these answers:
       - Style: New York
       - Base color: Neutral
       - CSS variables: yes
       - CSS file: src/app/globals.css
       - Tailwind config: (skip, using CSS-first v4)
       - Components alias: @/components
       - Utils alias: @/lib/utils
       - React Server Components: yes

       If the CLI prompts interactively in a way that blocks, instead manually:
       - Create `apps/web/components.json` with the shadcn/ui config pointing to `src/app/globals.css`, aliases `@/components` and `@/lib/utils`, style "new-york", tailwind v4 CSS variables enabled.
       - Create `apps/web/src/lib/utils.ts` with the cn() function (clsx + tailwind-merge).
       - Install deps: `npm install clsx tailwind-merge tw-animate-css lucide-react` from apps/web.

    3. Replace `apps/web/src/app/globals.css` with the FULL design token setup from the research:
       - `@import "tailwindcss"` and `@import "tw-animate-css"`
       - `@custom-variant dark (&:is(.dark *));`
       - Full `:root` block with all OKLCH color variables (background, foreground, card, popover, primary, secondary, muted, accent, destructive, border, input, ring, radius, sidebar-*)
       - Full `.dark` block with all dark overrides
       - Full `@theme inline` block mapping CSS vars to Tailwind utilities
       - `@layer base` with border-border and bg-background/text-foreground on body

    4. Install shadcn/ui components (from apps/web):
       ```bash
       npx shadcn@latest add button card input textarea label badge dialog dropdown-menu separator skeleton scroll-area sheet sidebar tabs tooltip avatar
       ```
       These get installed to `apps/web/src/components/ui/`.

    5. Install additional dependencies (from apps/web):
       ```bash
       npm install next-themes react-markdown remark-gfm
       ```

    6. Verify `apps/web/src/lib/utils.ts` exists and exports `cn`. If shadcn init created it, good. If not, create it:
       ```ts
       import { clsx, type ClassValue } from "clsx";
       import { twMerge } from "tailwind-merge";
       export function cn(...inputs: ClassValue[]) {
         return twMerge(clsx(inputs));
       }
       ```
  </action>
  <verify>
    - `ls apps/web/src/components/ui/button.tsx` exists
    - `ls apps/web/src/components/ui/sidebar.tsx` exists
    - `ls apps/web/src/lib/utils.ts` exists
    - `grep "tw-animate-css" apps/web/src/app/globals.css` returns a match
    - `grep "@theme inline" apps/web/src/app/globals.css` returns a match
    - `cd apps/web && npx tsc --noEmit` passes (or at least no errors in the new files)
  </verify>
  <done>
    shadcn/ui is initialized with all required components installed in apps/web/src/components/ui/. globals.css contains full design token setup with light and dark themes. cn() utility is available at @/lib/utils. All new dependencies (next-themes, react-markdown, remark-gfm, lucide-react, clsx, tailwind-merge, tw-animate-css) are installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create app shell (sidebar, theme provider, font, shared components) and wire into layouts</name>
  <files>
    apps/web/src/app/layout.tsx
    apps/web/src/app/(app)/layout.tsx
    apps/web/src/providers/index.tsx
    apps/web/src/components/theme-provider.tsx
    apps/web/src/components/theme-toggle.tsx
    apps/web/src/components/app-sidebar.tsx
    apps/web/src/components/page-header.tsx
    apps/web/src/components/chat-markdown.tsx
    apps/web/src/components/auth-guard.tsx
  </files>
  <action>
    1. Create `apps/web/src/components/theme-provider.tsx`:
       ```tsx
       "use client";
       import { ThemeProvider as NextThemesProvider } from "next-themes";
       export function ThemeProvider({ children, ...props }: React.ComponentProps<typeof NextThemesProvider>) {
         return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
       }
       ```

    2. Create `apps/web/src/components/theme-toggle.tsx`:
       - "use client" component
       - Uses `useTheme()` from next-themes
       - Renders a shadcn/ui Button (variant="ghost", size="icon") with lucide-react Sun/Moon icons
       - Cycles through: light -> dark -> system, or use a DropdownMenu with three options
       - Icons swap based on current theme

    3. Update `apps/web/src/app/layout.tsx`:
       - Import `Inter` from `next/font/google` with `subsets: ["latin"]` and `variable: "--font-sans"`
       - Add `suppressHydrationWarning` to `<html>` tag
       - Add `className={`${inter.variable} font-sans antialiased`}` to `<body>`
       - Wrap `<Providers>` with `<ThemeProvider attribute="class" defaultTheme="system" enableSystem disableTransitionOnChange>`
       - Keep existing Providers wrapper inside ThemeProvider

    4. Create `apps/web/src/components/app-sidebar.tsx`:
       - "use client" component
       - Uses shadcn/ui Sidebar, SidebarContent, SidebarGroup, SidebarGroupLabel, SidebarGroupContent, SidebarMenu, SidebarMenuButton, SidebarMenuItem, SidebarHeader, SidebarFooter
       - Navigation items: Dashboard (/dashboard, LayoutDashboard icon), Chat (/chat, MessageSquare icon), Agents (/agents, Bot icon), Memory (/memory, Brain icon), Documents (/documents, FileText icon), Settings (/settings, Settings icon)
       - SidebarHeader: app name "MyCoach" with a small logo/icon
       - SidebarFooter: ThemeToggle component + sign-out button
       - Uses `usePathname()` from next/navigation to highlight active item
       - Uses lucide-react icons for each nav item

    5. Update `apps/web/src/app/(app)/layout.tsx`:
       - Import SidebarProvider, SidebarInset, SidebarTrigger from @/components/ui/sidebar
       - Import AppSidebar from @/components/app-sidebar
       - Keep AuthGuard wrapping everything
       - Structure:
         ```tsx
         <AuthGuard>
           <SidebarProvider>
             <AppSidebar />
             <SidebarInset>
               <header className="flex h-14 items-center gap-2 border-b px-4">
                 <SidebarTrigger />
               </header>
               <main className="flex-1 p-4 md:p-6">{children}</main>
             </SidebarInset>
           </SidebarProvider>
         </AuthGuard>
         ```
       - IMPORTANT: The chat page needs full-height control, so use `<main className="flex flex-1 flex-col overflow-hidden">` instead of padding. To handle this, make the main element use `flex-1` and let individual pages control their own padding. Use `<main className="flex flex-1 flex-col">{children}</main>` without extra padding -- pages that need padding will add their own (via PageHeader wrapper or direct classes). This avoids breaking the chat page's flex layout.

    6. Create `apps/web/src/components/page-header.tsx`:
       ```tsx
       export function PageHeader({ title, description, actions }: {
         title: string;
         description?: string;
         actions?: React.ReactNode;
       }) {
         return (
           <div className="flex items-center justify-between">
             <div>
               <h1 className="text-2xl font-semibold tracking-tight">{title}</h1>
               {description && <p className="text-muted-foreground">{description}</p>}
             </div>
             {actions && <div className="flex gap-2">{actions}</div>}
           </div>
         );
       }
       ```

    7. Create `apps/web/src/components/chat-markdown.tsx`:
       - "use client" component
       - Uses react-markdown with remarkGfm plugin
       - Custom component overrides for: p (mb-2 last:mb-0), strong (font-semibold), ul (ml-4 list-disc space-y-1), ol (ml-4 list-decimal space-y-1), li (standard), code (inline: rounded bg-muted px-1.5 py-0.5 text-sm font-mono), pre (rounded-lg bg-muted p-4 overflow-x-auto my-2), h1-h3 (appropriate sizes with mb), a (text-primary underline), blockquote (border-l-2 border-muted pl-4 italic), table/thead/tbody/tr/th/td with appropriate borders and padding
       - Export as `ChatMarkdown({ content }: { content: string })`

    8. Update `apps/web/src/components/auth-guard.tsx`:
       - Replace plain "Loading..." div with a centered Skeleton or spinner using design tokens
       - Use `className="flex h-screen items-center justify-center bg-background"`

    IMPORTANT NOTES:
    - Do NOT remove any existing page content. The existing pages will still render -- they just now appear inside the sidebar shell. They will look slightly off (double backgrounds, redundant headers) until Plans 02-04 restyle them. This is expected.
    - The chat page (chat/[id]) currently has its own ConversationSidebar. It will coexist with the app sidebar until Plan 03 refactors it. This is fine temporarily.
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - `cd apps/web && npm run build` succeeds (or at least no build errors in layout/sidebar files)
    - Manually verify: `grep "SidebarProvider" apps/web/src/app/\\(app\\)/layout.tsx` returns match
    - Manually verify: `grep "ThemeProvider" apps/web/src/app/layout.tsx` returns match
    - Manually verify: `grep "react-markdown" apps/web/src/components/chat-markdown.tsx` returns match
  </verify>
  <done>
    App shell is wired: all (app) routes render inside SidebarProvider + AppSidebar + SidebarInset. Root layout has ThemeProvider with Inter font. Shared components exist: ChatMarkdown (react-markdown), PageHeader, ThemeToggle. The app compiles and all existing functionality continues to work (pages render inside the new shell, just not yet restyled).
  </done>
</task>

</tasks>

<verification>
- `cd apps/web && npm run build` completes without errors
- All shadcn/ui components exist in `apps/web/src/components/ui/`
- globals.css has design tokens for both light and dark themes
- App shell renders a sidebar with navigation links on all (app) routes
- Dark mode toggle switches themes
- ChatMarkdown component can render markdown with headers, code blocks, lists, and tables
</verification>

<success_criteria>
- shadcn/ui is fully initialized with 15+ components in components/ui/
- Design tokens define a complete light/dark color system
- App shell with collapsible sidebar navigation wraps all authenticated pages
- Dark mode works with system preference detection
- Inter font loads via next/font
- ChatMarkdown, PageHeader, ThemeToggle shared components are available for subsequent plans
- `npm run build` passes
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-polish-styling/05-01-SUMMARY.md`
</output>

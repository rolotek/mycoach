---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - turbo.json
  - package.json
  - apps/web/package.json
  - apps/web/tsconfig.json
  - apps/web/next.config.ts
  - apps/web/src/app/layout.tsx
  - apps/web/src/app/page.tsx
  - apps/server/package.json
  - apps/server/tsconfig.json
  - apps/server/src/index.ts
  - apps/server/src/db/index.ts
  - apps/server/src/db/schema.ts
  - apps/server/drizzle.config.ts
  - packages/shared/package.json
  - packages/shared/tsconfig.json
  - packages/shared/src/index.ts
  - .env.example
  - .gitignore
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Running `npm install` at root succeeds and installs all workspace dependencies"
    - "PostgreSQL is available (local dev); DATABASE_URL points to it"
    - "Running `npm run dev` starts both Hono server (port 3001) and Next.js (port 3000)"
    - "Hono server responds to HTTP requests on port 3001"
    - "Drizzle can connect to PostgreSQL and push the schema"
  artifacts:
    - path: "turbo.json"
      provides: "Turborepo task configuration"
      contains: "tasks"
    - path: "apps/server/src/index.ts"
      provides: "Hono server entry point"
      exports: ["default"]
    - path: "apps/server/src/db/index.ts"
      provides: "Drizzle client connected to PostgreSQL"
      exports: ["db"]
    - path: "apps/server/src/db/schema.ts"
      provides: "Database schema with user-scoped tables"
      contains: "userSettings"
  key_links:
    - from: "apps/server/src/db/index.ts"
      to: "PostgreSQL"
      via: "pg driver with DATABASE_URL"
      pattern: "drizzle.*pg"
    - from: "apps/server/src/index.ts"
      to: "@hono/node-server"
      via: "serve function"
      pattern: "serve.*fetch.*app"
---

<objective>
Scaffold the Turborepo monorepo with apps/web (Next.js 15), apps/server (Hono), and packages/shared. Set up Drizzle ORM connection to existing local PostgreSQL and the application database schema. After this plan, `npm install && npm run dev` starts both apps and the server can connect to the database.

Purpose: Every subsequent plan depends on the project structure, database, and server being operational. This is the foundation that unblocks all other work.
Output: Working monorepo with Hono server, Next.js app, and Drizzle schema (PostgreSQL assumed available via DATABASE_URL).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Turborepo monorepo with workspace packages</name>
  <files>
    turbo.json
    package.json
    .gitignore
    .env.example
    apps/web/package.json
    apps/web/tsconfig.json
    apps/web/next.config.ts
    apps/web/src/app/layout.tsx
    apps/web/src/app/page.tsx
    apps/server/package.json
    apps/server/tsconfig.json
    packages/shared/package.json
    packages/shared/tsconfig.json
    packages/shared/src/index.ts
  </files>
  <action>
    Create the monorepo structure manually (do NOT use `npx create-turbo` -- it creates unwanted boilerplate). Build each file from scratch:

    1. **Root package.json**: Set `"name": "mycoach"`, `"private": true`, `"workspaces": ["apps/*", "packages/*"]`. Add scripts: `"dev": "turbo dev"`, `"build": "turbo build"`, `"lint": "turbo lint"`, `"type-check": "turbo type-check"`. Add devDependencies: `turbo` (latest).

    2. **turbo.json**: Configure tasks per the research pattern:
       ```json
       {
         "$schema": "https://turbo.build/schema.json",
         "tasks": {
           "build": { "dependsOn": ["^build"], "outputs": [".next/**", "dist/**"] },
           "dev": { "cache": false, "persistent": true },
           "lint": {},
           "type-check": { "dependsOn": ["^build"] }
         }
       }
       ```

    3. **apps/server/package.json**: Set `"name": "@mycoach/server"`. Dependencies: `hono`, `@hono/node-server`, `drizzle-orm`, `pg`, `zod`, `pino`. DevDependencies: `drizzle-kit`, `@types/pg`, `typescript`, `tsx`, `@types/node`. Scripts: `"dev": "tsx watch src/index.ts"`, `"build": "tsc"`, `"db:push": "drizzle-kit push"`, `"db:generate": "drizzle-kit generate"`.

    4. **apps/web/package.json**: Set `"name": "@mycoach/web"`. Dependencies: `next`, `react`, `react-dom`. DevDependencies: `typescript`, `@types/react`, `@types/react-dom`, `tailwindcss`, `@tailwindcss/postcss`. Scripts: `"dev": "next dev"`, `"build": "next build"`.

    5. **packages/shared/package.json**: Set `"name": "@mycoach/shared"`. Add `"exports": { ".": "./src/index.ts", "./*": "./src/*.ts" }`. Dependencies: `zod`. DevDependencies: `typescript`. Create `src/index.ts` that exports a placeholder (e.g., `export const SHARED_VERSION = "0.1.0";`).

    6. **TypeScript configs**: Each workspace gets a `tsconfig.json`. Server: target ES2022, module NodeNext, moduleResolution NodeNext, strict true, outDir dist. Web: extend Next.js defaults. Shared: target ES2022, module NodeNext, declaration true.

    7. **apps/web/next.config.ts**: Minimal Next.js config with `transpilePackages: ["@mycoach/shared"]`.

    8. **apps/web/src/app/layout.tsx**: Root layout with html/body tags, metadata title "MyCoach".

    9. **apps/web/src/app/page.tsx**: Simple placeholder page: "MyCoach - Coming Soon".

    10. **.env.example**: Include all env vars needed for Phase 1:
        ```
        DATABASE_URL=postgresql://mycoach:mycoach@localhost:5432/mycoach
        BETTER_AUTH_SECRET=change-me-to-a-random-secret
        BETTER_AUTH_URL=http://localhost:3001
        WEB_URL=http://localhost:3000
        GOOGLE_CLIENT_ID=
        GOOGLE_CLIENT_SECRET=
        MICROSOFT_CLIENT_ID=
        MICROSOFT_CLIENT_SECRET=
        ANTHROPIC_API_KEY=
        OPENAI_API_KEY=
        OLLAMA_BASE_URL=http://localhost:11434/api
        ```

    11. **.gitignore**: Update to include: `node_modules/`, `.next/`, `dist/`, `.env`, `.env.local`, `.turbo/`, `*.tsbuildinfo`.

    12. Run `npm install` at root to verify workspace resolution works.
  </action>
  <verify>
    - `npm install` completes without errors
    - `ls apps/web/node_modules` and `ls apps/server/node_modules` show symlinked dependencies
    - `npx turbo build --dry-run` shows the correct task graph (server, web, shared)
  </verify>
  <done>
    Monorepo structure exists with three workspaces. `npm install` succeeds. Turborepo recognizes all packages and their dependency relationships.
  </done>
</task>

<task type="auto">
  <name>Task 2: Drizzle DB connection + schema + Hono server entry</name>
  <files>
    apps/server/src/index.ts
    apps/server/src/db/index.ts
    apps/server/src/db/schema.ts
    apps/server/drizzle.config.ts
  </files>
  <action>
    1. **apps/server/drizzle.config.ts**:
       ```typescript
       import { defineConfig } from "drizzle-kit";
       export default defineConfig({
         schema: "./src/db/schema.ts",
         out: "./drizzle",
         dialect: "postgresql",
         dbCredentials: {
           url: process.env.DATABASE_URL!,
         },
       });
       ```

    2. **apps/server/src/db/schema.ts**: Define user-scoped application tables (Better Auth manages its own tables via its adapter -- these are OUR tables):
       ```typescript
       import { pgTable, text, timestamp, uuid, varchar, jsonb } from "drizzle-orm/pg-core";

       export const userSettings = pgTable("user_settings", {
         id: uuid("id").primaryKey().defaultRandom(),
         userId: text("user_id").notNull(),
         preferredProvider: varchar("preferred_provider", { length: 50 }).default("anthropic"),
         preferredModel: varchar("preferred_model", { length: 100 }).default("anthropic:claude-sonnet-4-20250514"),
         settings: jsonb("settings").default({}),
         createdAt: timestamp("created_at").defaultNow().notNull(),
         updatedAt: timestamp("updated_at").defaultNow().notNull(),
       });
       ```
       Do NOT define conversations or messages tables yet -- those are Phase 2.

    3. **apps/server/src/db/index.ts**: Create Drizzle client:
       ```typescript
       import { drizzle } from "drizzle-orm/node-postgres";
       import { Pool } from "pg";
       import * as schema from "./schema";

       const pool = new Pool({
         connectionString: process.env.DATABASE_URL,
       });

       export const db = drizzle(pool, { schema });
       ```

    4. **apps/server/src/index.ts**: Minimal Hono server that proves it runs:
       ```typescript
       import { Hono } from "hono";
       import { serve } from "@hono/node-server";

       const app = new Hono();

       app.get("/health", (c) => c.json({ status: "ok" }));

       const port = Number(process.env.PORT) || 3001;
       console.log(`Server running on port ${port}`);
       serve({ fetch: app.fetch, port });

       export default app;
       ```

    5. Copy `.env.example` to `.env` and set `DATABASE_URL` to your existing local Postgres (e.g. `postgresql://localhost:5432/mycoach`). Create the database if needed: `createdb mycoach`.

    6. Push schema to database: `cd apps/server && npx drizzle-kit push`

    7. Verify Hono starts: `cd apps/server && npx tsx src/index.ts` (run briefly, ctrl-c after confirming startup log).
  </action>
  <verify>
    - `cd apps/server && npx drizzle-kit push` succeeds and creates the `user_settings` table (Postgres must be running and DATABASE_URL set)
    - `curl http://localhost:3001/health` returns `{"status":"ok"}` (start server, test, stop)
    - `npm run dev` from root starts both server and web concurrently
  </verify>
  <done>
    Drizzle schema is pushed to existing PostgreSQL with `user_settings` table. Hono server starts on port 3001 and responds to /health. `npm run dev` from root starts both apps via Turborepo.
  </done>
</task>

</tasks>

<verification>
- `npm install` at root succeeds
- Postgres available; DATABASE_URL in .env points to it
- `npm run dev` starts Hono on 3001 and Next.js on 3000
- `curl http://localhost:3001/health` returns OK
- Database has `user_settings` table
</verification>

<success_criteria>
- Turborepo monorepo with 3 workspaces resolves all dependencies
- Drizzle connects to existing PostgreSQL and schema is pushed with user_settings table
- Hono server starts and responds on port 3001
- Next.js starts and renders on port 3000
- `npm run dev` runs both concurrently
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
